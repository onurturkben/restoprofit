{% extends 'base.html' %}

{% block content %}

    <div class="container">
        <h1 class="mb-4"><i class="bi bi-gear-fill"></i> Menü & Maliyet Yönetimi</h1>
        
        <div class="alert alert-warning" role="alert">
            <strong>Dikkat:</strong> Bu panel, `app.py` dosyası içindeki gömülü listeyi kullanarak tüm hammaddeleri, ürünleri ve reçeteleri <strong>sıfırlar ve yeniden oluşturur.</strong>
            <br>
            <strong>Bu işlem geçmiş satış kayıtlarınızı SİLMEZ.</strong>
        </div>

        <div class="mb-4">
            <form action="{{ url_for('reset_menu_data') }}" method="POST" onsubmit="return confirm('Tüm Hammadde, Ürün ve Reçete verileriniz silinecek ve app.py\'deki verilerle yeniden yüklenecek. Emin misiniz? (Satış geçmişiniz korunacak.)');">
                <button type="submit" class="btn btn-danger btn-lg">
                    <i class="bi bi-arrow-clockwise"></i> Menü Verilerini Sıfırla ve Yeniden Kur
                </button>
            </form>
        </div>

        <hr class="my-5">

        <div class="row">
            <div class="col-md-12">
                <h2>Ürünler ({{ urunler|length }} adet)</h2>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <table class="table table-striped table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>İsim</th>
                                    <th>Excel Adı</th>
                                    <th>Fiyat</th>
                                    <th>Maliyet (Hesaplanan)</th>
                                    <th>Kategori</th>
                                    <th>Grup</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for urun in urunler %}
                                <tr>
                                    <td><strong>{{ urun.isim }}</strong></td>
                                    <td>{{ urun.excel_adi }}</td>
                                    <td>{{ "%.2f"|format(urun.mevcut_satis_fiyati) }} TL</td>
                                    <td>{{ "%.2f"|format(urun.hesaplanan_maliyet) }} TL</td>
                                    <td>{{ urun.kategori }}</td>
                                    <td>{{ urun.kategori_grubu }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-6">
                <h2>Hammaddeler ({{ hammaddeler|length }} adet)</h2>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <table class="table table-striped table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>İsim</th>
                                    <th>Birim</th>
                                    <th>Fiyat</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for hammadde in hammaddeler %}
                                <tr>
                                    <td>{{ hammadde.isim }}</td>
                                    <td>{{ hammadde.maliyet_birimi }}</td>
                                    <td>{{ "%.2f"|format(hammadde.maliyet_fiyati) }} TL</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <h2>Reçeteler ({{ receteler|length }} adet)</h2>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <table class="table table-striped table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Ürün</th>
                                    <th>Hammadde</th>
                                    <th>Miktar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for recete in receteler %}
                                <tr>
                                    <td>{{ recete.urun.isim }}</td>
                                    <td>{{ recete.hammadde.isim }}</td>
                                    <td>{{ recete.miktar }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

{% endblock %}
