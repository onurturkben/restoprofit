{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
  <h1 class="mb-4"><i class="bi bi-gear"></i> Menü Yönetimi</h1>

  <!-- Eylem butonları -->
  <div class="d-flex flex-wrap gap-2 mb-4">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAddMaterial">
      <i class="bi bi-box-seam"></i> Hammadde Ekle
    </button>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalAddProduct">
      <i class="bi bi-basket3"></i> Ürün Ekle
    </button>
    <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modalAddRecipe">
      <i class="bi bi-journal-plus"></i> Reçete Oluştur
    </button>
  </div>

  <!-- Hata mesajı -->
  {% if hata %}
  <div class="alert alert-danger">{{ hata }}</div>
  {% endif %}

  <!-- Hammadde Tablosu -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="card-title"><i class="bi bi-box-seam"></i> Hammaddeler</h4>
      {% if hammaddeler %}
      <div class="table-responsive mt-3">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>İsim</th>
              <th>Birim</th>
              <th>Birim Fiyatı (TL)</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody>
            {% for h in hammaddeler %}
            <tr>
              <td>{{ h.isim }}</td>
              <td>{{ h.maliyet_birimi }}</td>
              <td>{{ "%.2f"|format(h.birim_fiyati) }}</td>
              <td>
                <form method="POST" action="{{ url_for('delete_material', id=h.id) }}" onsubmit="return confirm('Silmek istediğine emin misin?')" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted">Henüz hammadde eklenmemiş.</p>
      {% endif %}
    </div>
  </div>

  <!-- Ürün Tablosu -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="card-title"><i class="bi bi-basket3"></i> Ürünler</h4>
      {% if urunler %}
      <div class="table-responsive mt-3">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>İsim</th>
              <th>Excel Adı</th>
              <th>Kategori</th>
              <th>Grup</th>
              <th>Satış Fiyatı</th>
              <th>Maliyet</th>
              <th>Kâr Marjı (%)</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody>
            {% for u in urunler %}
            <tr>
              <td>{{ u.isim }}</td>
              <td>{{ u.excel_adi }}</td>
              <td>{{ u.kategori }}</td>
              <td>{{ u.kategori_grubu }}</td>
              <td>{{ "%.2f"|format(u.satis_fiyati) }}</td>
              <td>{{ "%.2f"|format(u.maliyet) }}</td>
              <td>{{ "%.1f"|format(u.kar_marji) }}</td>
              <td>
                <form method="POST" action="{{ url_for('delete_product', id=u.id) }}" onsubmit="return confirm('Silmek istediğine emin misin?')" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted">Henüz ürün eklenmemiş.</p>
      {% endif %}
    </div>
  </div>

  <!-- Reçete Tablosu -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h4 class="card-title"><i class="bi bi-journal-text"></i> Reçeteler</h4>
      {% if receteler %}
      <div class="table-responsive mt-3">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Ürün</th>
              <th>Hammadde</th>
              <th>Miktar</th>
              <th>Birim</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody>
            {% for r in receteler %}
            <tr>
              <td>{{ r.urun.isim }}</td>
              <td>{{ r.hammadde.isim }}</td>
              <td>{{ r.miktar }}</td>
              <td>{{ r.hammadde.maliyet_birimi }}</td>
              <td>
                <form method="POST" action="{{ url_for('delete_recipe', id=r.id) }}" onsubmit="return confirm('Silmek istediğine emin misin?')" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted">Henüz reçete eklenmemiş.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- modallar dahil -->
{% include 'modals.html' %}

{% endblock %}
