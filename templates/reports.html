{% extends 'base.html' %}

{% block content %}

    <h1 class="mb-5"><i class="bi bi-robot"></i> Analiz Motorları</h1>

    <div class="row justify-content-center">
        <div class="col-lg-8">

            <section class="mb-5"> <h3>Motor 1: Hedef Marj Hesaplayıcı</h3>
                <p class="text-muted">Bir ürünün maliyetine göre, istediğiniz kar marjı için gereken satış fiyatını hesaplar.</p>
                <form action="{{ url_for('reports') }}" method="POST" class="mt-4">
                    <input type="hidden" name="analiz_tipi" value="hedef_marj">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="urun_marj" class="form-label">Ürün Seçin:</label>
                            <select class="form-select" name="urun_ismi" id="urun_marj" required>
                                {% for urun in urun_listesi %}<option value="{{ urun }}">{{ urun }}</option>{% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="hedef_marj" class="form-label">Hedef Marj (%):</label>
                            <input type="number" class="form-control" name="hedef_marj" id="hedef_marj" value="70" step="1" min="1" max="99" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-info"><i class="bi bi-calculator"></i> Hesapla</button>
                </form>
            </section>

            <hr class="my-5"> <section class="mb-5"> <h3>Motor 2: Fiyat Simülatörü</h3>
                <p class="text-muted">"Ya... olursa?" analizi. Bir ürünün fiyatını değiştirirseniz tahmini karınızın ne olacağını söyler.</p>
                <form action="{{ url_for('reports') }}" method="POST" class="mt-4">
                    <input type="hidden" name="analiz_tipi" value="simulasyon">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="urun_sim" class="form-label">Ürün Seçin:</label>
                            <select class="form-select" name="urun_ismi" id="urun_sim" required>
                                {% for urun in urun_listesi %}<option value="{{ urun }}">{{ urun }}</option>{% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="yeni_fiyat" class="form-label">Yeni Fiyat (TL):</label>
                            <input type="number" class="form-control" name="yeni_fiyat" id="yeni_fiyat" value="300" step="1" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning"><i class="bi bi-graph-up"></i> Simüle Et</button>
                </form>
            </section>

            <hr class="my-5">

            <section class="mb-5">
                <h3>Motor 3: Optimum Fiyat Motoru</h3>
                <p class="text-muted">Bir ürün için "Maksimum Kar" getirecek optimum fiyatı, geçmiş verilere göre tahmin eder.</p>
                <form action="{{ url_for('reports') }}" method="POST" class="mt-4">
                    <input type="hidden" name="analiz_tipi" value="optimum_fiyat">
                    <div class="mb-3">
                        <label for="urun_opt" class="form-label">Ürün Seçin:</label>
                        <select class="form-select" name="urun_ismi" id="urun_opt" required>
                            {% for urun in urun_listesi %}<option value="{{ urun }}">{{ urun }}</option>{% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success"><i class="bi bi-trophy"></i> Optimum Fiyatı Bul</button>
                </form>
            </section>
            
            <hr class="my-5">

            <section class="mb-5">
                <h3>Motor 4: Stratejist Asistan (Kategori)</h3>
                <p class="text-muted">Kategori içi yamyamlığı (cannibalization) tespit eder. (Örn: Cheeseburger vs Steak Burger)</p>
                <form action="{{ url_for('reports') }}" method="POST" class="mt-4">
                    <input type="hidden" name="analiz_tipi" value="kategori">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="kategori_isim" class="form-label">Kategori Seçin:</label>
                            <select class="form-select" name="kategori_ismi" id="kategori_isim" required>
                                {% for kat in kategori_listesi %}<option value="{{ kat }}">{{ kat }}</option>{% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="gun_kat" class="form-label">Periyot (Gün):</label>
                            <input type="number" class="form-control" name="gun_sayisi" id="gun_kat" value="7" step="1" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-danger"><i class="bi bi-bullseye"></i> Analiz Et</button>
                </form>
            </section>
            
            <hr class="my-5">

            <section class="mb-5">
                <h3>Motor 5: Genel Stratejist (Grup)</h3>
                <p class="text-muted">Çapraz kategori yamyamlığını tespit eder. (Örn: Burgerler vs Et Yemekleri). En rasyonel analizdir.</p>
                <form action="{{ url_for('reports') }}" method="POST" class="mt-4">
                    <input type="hidden" name="analiz_tipi" value="grup">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="grup_isim" class="form-label">Kategori Grubu Seçin:</label>
                            <select class="form-select" name="grup_ismi" id="grup_isim" required>
                                {% for grup in grup_listesi %}<option value="{{ grup }}">{{ grup }}</option>{% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="gun_grup" class="form-label">Periyot (Gün):</label>
                            <input type="number" class="form-control" name="gun_sayisi" id="gun_grup" value="7" step="1" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="bi bi-gem"></i> Analiz Et</grup_isim>
                </form>
            </section>

            <hr class="my-5">

            <h2 class="mb-4">Analiz Sonucu</h2>
            
            {% if analiz_sonucu %}
                <pre>{{ analiz_sonucu }}</pre>
            {% else %}
                <div class="alert alert-secondary" role="alert">
                    Lütfen yukarıdaki motorlardan birini çalıştırın. Rapor sonucu burada görünecektir.
                </div>
            {% endif %}

        </div> </div> {% endblock %}
