{% extends 'base.html' %}

{% block content %}
<header class="mb-4 d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-2">
  <div>
    <h1 class="fw-bold mb-1" style="font-size:32px; line-height:40px;">Ana Ekran</h1>
    <p class="text-muted mb-0">
      Son {{ days_window or 30 }} gÃ¼ne gÃ¶re Ã¶zet ve hÄ±zlÄ± iÃ§gÃ¶rÃ¼ler.
    </p>
  </div>

  <!-- âœ… HÄ±zlÄ± filtre linkleri -->
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('dashboard', days=7) }}">7 gÃ¼n</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('dashboard', days=30) }}">30 gÃ¼n</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('dashboard', days=90) }}">90 gÃ¼n</a>
  </div>
</header>

<!-- âœ… Ãœst Ã¶zet kartlarÄ± -->
<div class="row g-3 mb-4">
  <div class="col-12 col-md-6">
    <div class="rp-card rp-shadow h-100">
      <div class="rp-card-body d-flex align-items-start justify-content-between gap-3">
        <div>
          <h3 class="h6 fw-bold text-muted mb-1">Toplam ÃœrÃ¼n</h3>
          <div class="d-flex align-items-end gap-2">
            <div class="display-6 m-0">{{ summary.toplam_urun }}</div>
            <small class="text-muted mb-2">adet</small>
          </div>
        </div>
        <div class="rounded-3 p-2" style="background:rgba(37,99,235,.08); border:1px solid rgba(37,99,235,.18);">
          <span style="font-size:18px;">ğŸ“¦</span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6">
    <div class="rp-card rp-shadow h-100">
      <div class="rp-card-body d-flex align-items-start justify-content-between gap-3">
        <div>
          <h3 class="h6 fw-bold text-muted mb-1">Toplam SatÄ±ÅŸ KaydÄ±</h3>
          <div class="d-flex align-items-end gap-2">
            <div class="display-6 m-0">{{ summary.toplam_satis_kaydi }}</div>
            <small class="text-muted mb-2">adet</small>
          </div>
        </div>
        <div class="rounded-3 p-2" style="background:rgba(22,163,74,.10); border:1px solid rgba(22,163,74,.22);">
          <span style="font-size:18px;">ğŸ§¾</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Ä°Ã§gÃ¶rÃ¼ler (app.py'den gelen insights) -->
<div class="rp-card rp-shadow mb-4">
  <div class="rp-card-body">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h2 class="h5 fw-bold m-0">BugÃ¼n Ne YapmalÄ±yÄ±m?</h2>
      <span class="badge text-bg-primary">Ã–neriler</span>
    </div>
    <p class="text-muted small mb-3">Sistem, son {{ days_window or 30 }} gÃ¼ne gÃ¶re otomatik aksiyon Ã¶nerileri Ã§Ä±karÄ±r.</p>

    {% if insights and insights|length %}
      <div class="d-flex flex-column gap-2">
        {% for it in insights %}
          {% set t = (it.type or 'info') %}
          {% if t == 'danger' %}
            {% set cls = 'alert-danger' %}
          {% elif t == 'warning' %}
            {% set cls = 'alert-warning' %}
          {% elif t == 'success' %}
            {% set cls = 'alert-success' %}
          {% else %}
            {% set cls = 'alert-info' %}
          {% endif %}

          <div class="alert {{ cls }} mb-0" role="alert" style="border-radius:14px;">
            <div class="fw-bold" style="opacity:.92;">{{ it.text }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-light mb-0" role="alert">
        HenÃ¼z iÃ§gÃ¶rÃ¼ Ã¼retilecek veri yok. Excel yÃ¼kleyince Ã¶neriler otomatik gÃ¶rÃ¼necek.
      </div>
    {% endif %}
  </div>
</div>

<!-- âœ… En iyi / En kÃ¶tÃ¼ 3 Ã¼rÃ¼n -->
<div class="row g-3 mb-4">
  <div class="col-12 col-lg-6">
    <div class="rp-card rp-shadow h-100">
      <div class="rp-card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h5 fw-bold m-0">En Ä°yi 3 ÃœrÃ¼n</h2>
          <span class="badge text-bg-success">Marj â†‘</span>
        </div>
        <p class="text-muted small mb-3">Son {{ days_window or 30 }} gÃ¼n / kÃ¢r marjÄ±na gÃ¶re</p>

        {% if best_products and best_products|length %}
          <div class="list-group list-group-flush">
            {% for p in best_products %}
              <div class="list-group-item px-0 d-flex align-items-start justify-content-between">
                <div class="me-3">
                  <div class="fw-bold">
                    <span class="me-1" style="color:rgba(22,163,74,.95);">#{{ loop.index }}</span>
                    {{ p.urun_adi }}
                  </div>
                  <div class="text-muted small">
                    Adet: {{ p.adet }} Â· Ciro: {{ "%.2f"|format(p.ciro) }} TL Â· KÃ¢r: {{ "%.2f"|format(p.kar) }} TL
                  </div>
                </div>
                <div class="text-end">
                  <div class="fw-bold">%{{ "%.1f"|format(p.marj) }}</div>
                  <div class="text-muted small">marj</div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light mb-0" role="alert">
            Bu aralÄ±kta satÄ±ÅŸ verisi bulunamadÄ±. (Excel yÃ¼kledikten sonra gÃ¶rÃ¼nÃ¼r.)
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="rp-card rp-shadow h-100">
      <div class="rp-card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h5 fw-bold m-0">En KÃ¶tÃ¼ 3 ÃœrÃ¼n</h2>
          <span class="badge text-bg-danger">Marj â†“</span>
        </div>
        <p class="text-muted small mb-3">Son {{ days_window or 30 }} gÃ¼n / kÃ¢r marjÄ±na gÃ¶re</p>

        {% if worst_products and worst_products|length %}
          <div class="list-group list-group-flush">
            {% for p in worst_products %}
              <div class="list-group-item px-0 d-flex align-items-start justify-content-between">
                <div class="me-3">
                  <div class="fw-bold">
                    <span class="me-1" style="color:rgba(239,68,68,.95);">#{{ loop.index }}</span>
                    {{ p.urun_adi }}
                  </div>
                  <div class="text-muted small">
                    Adet: {{ p.adet }} Â· Ciro: {{ "%.2f"|format(p.ciro) }} TL Â· KÃ¢r: {{ "%.2f"|format(p.kar) }} TL
                  </div>
                </div>
                <div class="text-end">
                  <div class="fw-bold">%{{ "%.1f"|format(p.marj) }}</div>
                  <div class="text-muted small">marj</div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light mb-0" role="alert">
            Bu aralÄ±kta satÄ±ÅŸ verisi bulunamadÄ±. (Excel yÃ¼kledikten sonra gÃ¶rÃ¼nÃ¼r.)
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Excel yÃ¼kleme kartÄ± -->
<div class="rp-card rp-shadow">
  <div class="rp-card-body">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-2">
      <h2 class="h5 fw-bold mb-0">Yeni SatÄ±ÅŸ Raporu YÃ¼kle</h2>
      <a class="btn btn-dark btn-sm" href="{{ url_for('reports') }}">Analiz MotorlarÄ±na Git</a>
    </div>

    <p class="text-muted mb-1">Adisyon sisteminizden aldÄ±ÄŸÄ±nÄ±z <code>.xlsx/.xls</code> dosyasÄ±nÄ± yÃ¼kleyin.</p>
    <p class="text-muted small mb-4">Gerekli kolonlar: <code>Urun_Adi</code>, <code>Adet</code>, <code>Toplam_Tutar</code>, <code>Tarih</code></p>

    <form method="POST" action="{{ url_for('upload_excel') }}" enctype="multipart/form-data" class="d-flex flex-wrap gap-2">
      <input class="form-control" style="max-width:420px;" type="file" name="excel_file" accept=".xlsx,.xls" required>
      <button class="btn btn-success">YÃ¼kle ve Ä°ÅŸle</button>
    </form>

    <div class="text-muted small mt-3">
      Ä°pucu: Son 7 gÃ¼n gÃ¶rmek iÃ§in <code>/dashboard?days=7</code> ya da yukarÄ±daki filtreleri kullan.
    </div>
  </div>
</div>
{% endblock %}
